## Hi, decided to call the data set Food_Sec, have loaded the entire data set and would then subset it to the columns we are working on.
## There was one Raw_Data.csv file aswell that had done this already but that didn't have all the observations
getwd()

## Installng tidyverse to use dplyr to rename the columns
install.packages('tidyverse')
Food_Sec <- data.frame(read.csv("dec21pub.csv"))
```{r}
library(dplyr)
library(ezids)
library(ggplot2)
```

```{r, results='markup'}


FS_Subset <- subset(Food_Sec, HRINTSTA == 001 & HRSUPINT == 001)
FS_Subset <- subset(FS_Subset, select = c("HRHHID",	"GESTFIPS",	"HRNUMHOU",	"HEFAMINC",	"HESP1",	"PTDTRACE",	"PRCITSHP",	"PEMJNUM",	"PEHRUSL1",	"PEEDUCA", "HRFS12MD"))

FS_Subset <- FS_Subset %>% rename("Id" = "HRHHID", "States" = "GESTFIPS", "Family_Size" = "HRNUMHOU",	"Household_Income" = "HEFAMINC",	"SNAP" = "HESP1",	"Ethnicity" =	"PTDTRACE", "Citizenship_status" = "PRCITSHP",	"Number_of_Jobs" = "PEMJNUM",	"Hours_on_Jobs" = "PEHRUSL1" , "Education_Level" = "PEEDUCA" , "FoodSecurity_score" = "HRFS12MD")

## Converting the all the columns to factors as they are all ordinal(except the Id, but since it's categorical i'm converting it into a factor too)

FS_Subset[] <- lapply( FS_Subset, factor)


str(FS_Subset)
```


##Exploring the Food Security Score

```{r, results='markup'}
levels(FS_Subset$'FoodSecurity_score') <- c("No Response", "High Food Security", "Marginal Food Security", "Low Food Security", "Very Low Food Security")
summary(FS_Subset$'FoodSecurity_score')
```
  
##1 :High Food Security, 2 : Marginal Food Security , 3 : Low Food Security, 4  : Very Low Food Security ,-9 : No Response
## Children’s Food Security Scale variables are coded as “Not in Universe” (-1) if there were no children in the household. 
## Attachment 17, on page 288, contains details about the food security score. I have only given it a cursory glace, but we will have to read it in detail.




```{r, results='markup', }
df <- FS_Subset %>% 
  group_by(FoodSecurity_score) %>% # Variable to be transformed
  count() %>% 
  ungroup() %>% 
  mutate(perc = `n` / sum(`n`)) %>% 
  arrange(perc) %>%
  mutate(labels = scales::percent(perc))

ggplot(df, aes(x = "", y = perc, fill = FoodSecurity_score)) +
  geom_col() +
    geom_text(aes(label = labels),
            position = position_stack(vjust = 0.5)) +
  coord_polar(theta = "y")



```

## Renaming levels of Ethnicity and Citizenship_Status
```{r, results='markup'}
levels(FS_Subset$'Ethnicity') <- c('White only', 'Black only', 'American Indian, Alaskan native only', 'Asian Only', 'Hawaiian', 'White-black', 'White-AI', 'White-Asian', 'White-HP', 'Black-AI', 'Black-Asian', 'Black-HP', 'AI-Asian', 'AI-HP', 'Asian-HP', 'W-B-AI', 'W-B-A', 'W-B-HP', 'W-AI-A', 'W-AI-HP', 'W-A-HP', 'B-AI-A', 'W-B-AL-A', 'W-AI-A-HP', 'Other 3 race combo', 'Other 4 and 5 race combo')
summary(FS_Subset$'Ethnicity', title = "PTDTRACE")

summary(FS_Subset$'SNAP', title = "HESP1")

levels(FS_Subset$'Citizenship_status') <- c('NATIVE, BORN IN THE UNITED STATES', 'NATIVE, BORN IN PUERTO RICO OR OTHER U.S. ISLAND AREAS', 'NATIVE, BORN ABROAD OF AMERICAN PARENT OR PARENTS', 'FOREIGN BORN, U.S. CITIZEN BY NATURALIZATION', 'FOREIGN BORN, NOT A CITIZEN OF THE UNITED STATES')
summary(FS_Subset$'Citizenship_status', title = "PRCITSHP")


```
## Plotting barcharts between all the levels of each factor and food security status

```{r, results='markup'}
for(i in levels(FS_Subset$Ethnicity)){
   
  print(ggplot(subset(FS_Subset, Ethnicity == i ) , aes(x= Ethnicity, color =FoodSecurity_score, fill = FoodSecurity_score)) + geom_bar( aes(y = (..count..)/sum(..count..)*100), position = "dodge"))
}
```

```{r, results='markup'}
for(i in levels(FS_Subset$Citizenship_status)){
   
  print(ggplot(subset(FS_Subset, Citizenship_status == i ) , aes(x= Citizenship_status, color =FoodSecurity_score, fill = FoodSecurity_score)) + geom_bar( aes(y = (..count..)/sum(..count..)*100), position = "dodge"))
}



```


```{r}
food_fc <- subset(Food_Sec, HUFINAL == 001)
head(food_fc)
food_final <- subset(food_fc, select = c("HRHHID",	"GTCO",	"GESTFIPS",	"HRNUMHOU",	"HEFAMINC",	"HESP1",	"PTDTRACE",	"PRCITSHP",	"PEMJNUM",	"PEHRUSL1",	"PEEDUCA", "HRFS12MD"))
str(food_final)
```

```{r data_ave, results='markup'}
food_ave <- subset(food_final, select = c("HRHHID",	"PEMJNUM",	"PEHRUSL1",	"PEEDUCA", "HRFS12MD"))
head(food_ave)

#Now I rename the columns

colnames(food_ave) <- c("ID", "No_of_jobs","Hours_of_job","Edcation_Level","Food_Seurity_Score")
xkabledply(food_ave, title = "Data set")
```
